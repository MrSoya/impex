/*
 * impexjs is a powerful web application engine to build 
 * reactive webUI system
 *
 *
 * Copyright 2015-2018 MrSoya and other contributors
 * Released under the MIT license
 *
 * website: http://impexjs.org
 * last build: 2018-03-09
 */
!function(e){"use strict";function t(e,t){for(var n=Object.keys(e),r=n.length;r--;){var i=n[r];t[i]=e[i]}}function n(e){return"object"==typeof e&&null!==e}function r(e){return e instanceof Array}function i(e){return"string"==typeof e}function o(e){return void 0===e}function a(e){return e instanceof Function}function s(){var e=Ae[this.url].name;Se(e,"can not fetch remote data of : "+this.url)}function c(){var e=Ae[this.url].name;Se(e,"load timeout : "+this.url)}function l(){if(0===this.status||this.status>=200&&this.status<300||304===this.status){var e=this.responseText,t=Ae[this.url],n=t.cbks,r=t.name;e.match(/<\s*template[^<>]*>([\s\S]*)<\s*\/\s*template\s*>/gim)[0];var i=RegExp.$1;if(!i)return void Se(r,"can not find tag <template> in component file");var o="";i=i.replace(/<\s*style[^<>]*>([\s\S]*?)<\s*\/\s*style\s*>/gim,function(e,t){return o+=t,""}),e.match(/<\s*script[^<>]*>([\s\S]*?)<\s*\/\s*script\s*>/gim)[0];var a=RegExp.$1,s=new Function("return ("+a+")")();s=s(),s.template=i.trim();{this.url}n.forEach(function(e){e(s,o.trim())}),Ae[this.url]=null}}function u(e,t,n,r){if(Ae[t])return void Ae[t].cbks.push(n);Ae[t]={name:e,cbks:[]},Ae[t].cbks.push(n);var i=new XMLHttpRequest;i.open("get",t,!0),i.timeout=r||5e3,i.ontimeout=c,i.onerror=s,null===i.onload?i.onload=l:i.onreadystatechange=l,i.url=t,i.send(null)}function f(e,t,n){this.type=e,this.tag=t,this.txtQ=n,this.children=[],this.attrNodes={},this.slotMap={}}function h(e,t){this.value,this.name=e,this.directive=t}function p(e,t,n){this.tag=e,this.txt,this.children,this.vid=Fe++,this.attrNodes=t,this._directives=n,this._comp,this.dom,this._forScopeQ,this._slotMap}function d(e,t,n,r,i,o,a){var s=new p(t,n,r);if(a.length>0&&(s._forScopeQ=a),_t[t]||"component"==t){s._comp=!0;var c=i[0];return c&&(s._slots=c[0],s._slotMap=c[1]),s}if(null!=o){{var l,u,f="",h="",b=[wt.$global,e,e.state,d,v,m,_,g],y=[];b.length}if(s._forScopeQ)for(var w=0;w<s._forScopeQ.length;w++){var x="forScope"+Le++;f+="with("+x+"){",h+="}",b.push(s._forScopeQ[w]),y.push(x)}try{u=j("<"+We+">"+o+"</"+We+">",e,y)}catch(O){return void Se(e.name,"[x-html] compile error on "+O.message)}var S=y.length>0?","+y.toString():"",E=new Function("$global,comp,state,_ce,_tmp,_ct,_li,_fi"+S,"with($global){with(comp){with(state){"+f+"return "+u+";"+h+"}}}");l=E.apply(e,b),i=l.children||[]}return i.length>0&&(s.children=[],i.forEach(function(e){e&&(e instanceof Array?e.forEach(function(e){e.parent=s,s.children.push(e)}):(e.parent=s,s.children.push(e)))})),s}function v(e,t){var n=null;t&&(n=[t]);var r=[];return e.length>0&&e.forEach(function(e){if(e)if(e instanceof Array)e.forEach(function(e){if(r.push(e),n){var t=e._forScopeQ;e._forScopeQ=t?n.concat(t):n}});else if(r.push(e),n){var t=e._forScopeQ;e._forScopeQ=t?n.concat(t):n}}),r}function m(e){var t=new p;return t.txt=e&&e.toString?e.toString():e,t}function _(e,t,n,i,o){var a=[];return e.forEach(function(e,s){var c={$index:s};i&&(c[i]=s),c[o]=e;var l=t.call(n,c);l&&(r(l)?a=a.concat(l):a.push(l))}),a}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n],i=dt[r[0]],o=r[1];o.unshift(e),e=i.apply(i,o)}return e}function b(e,t,n){var r=null,i=null,o=null;if(ot.test(e)){var a=e.replace(et,""),s=a.indexOf(tt);s>-1&&(a=a.substring(0,s)),r=a;var c=e.indexOf(tt);switch(c>-1&&(i=e.substr(c+1)),a){case"if":case"else":case"for":case"html":return a}if(!vt[a])return void Oe(t?t.name:"ROOT","there is no handler of directive '"+a+"' ")}else e[0]===lt?(r="on",i=e.substr(1)):e[0]!==ut||n||(r="bind",i=e.substr(1));if(i){var l=i.indexOf(nt);l>-1&&(o=i.substr(l+1),i=i.substring(0,l)),i=i.split(tt)}return r?[r,i,o]:r}function y(e,t){if("for"!==e)return!1;var n=null,r=t.exp[0],i=t.exp[1];if(!r.match(/^([\s\S]*?)\s+as\s+([\s\S]*?)$/))throw new Error("invalid each expression : "+r);var o=RegExp.$2,a=o.split(","),s=a.length>1?a[0]:null,c=a.length>1?a[1]:a[0],l=RegExp.$1;return n=l.match(/^([\s\S]*?)\s+to\s+([\s\S]*?)$/)?[s,c,i,RegExp.$1,RegExp.$2]:[s,c,i,l]}function w(e,t){return"if"!==e?!1:t.exp[0]}function x(e,t){return"html"!==e?!1:t.exp[0]}function O(e){for(var t,n=null,r=[],i=[],o=[];e.length>0;){if(!n){n=je.exec(e);var a=n.index+n[0].length;e=e.substr(a)}var s=n[1],c=new f(1,s),l=r[r.length-1];l?l.children.push(c):i.push(c);var u=n[2].trim(),h=u.match(Pe);h&&S(h,c),Te.indexOf(s)<0&&r.push(c);var p=je.exec(e);p&&(n=p),t=Me.exec(e);var d=t?t.index:-1,v=p?p.index:-1;if(l=r[r.length-1],v>-1&&d>v)E(e.substr(0,v),l),e=e.substr(v+p[0].length);else{E(e.substr(0,d),l);var m=d+t[0].length;Be.lastIndex=0,Be.exec(e);do{if(r.pop(),r.length<1)break;t=Be.exec(e),d=t.index;var _=e.substring(m,t.index);if(_.trim()){if(d>v){var g=je.exec(_);g&&(_=_.substr(0,g.index).trim())}_.trim()&&(c=r[r.length-1],E(_,c))}m=d+t[0].length}while(v>d);if(!p)break;e=e.substr(v+p[0].length)}}return[i,o]}function S(e,t){for(var n=e.length;n--;){var r,i=e[n],o=i.indexOf("="),a=null;0>o?r=i:(r=i.substring(0,o),a=i.substring(o+2,i.length-1));var s=new h(r,b(r,t));if(t.attrNodes[r]=s,s.value=a,s.directive){var c,l,o=a.indexOf("=>");0>o?c=a:(c=a.substring(0,o),l=a.substring(o+2,a.length)),s.exp=N(c,l);var u=null,f=s.directive;("for"===f||"if"===f||"else"===f||"html"===f)&&((u=y(f,s))&&(t["for"]=u),(u=w(f,s))&&(t["if"]=u),(u=x(f,s))&&(t.html=u),"else"===f&&(t["else"]=!0),t.attrNodes[s.name]=null,delete t.attrNodes[s.name])}}}function E(e,t){e=e.trim();var n=[];if(e){for(var r=null,i=0;r=ft.exec(e);){var o=e.substring(i,r.index);o&&n.push(o),n.push(N(r[1],r[2])),i=r.index+r[0].length}i<e.length,n.length<1&&n.push(e);var a=new f(3,null,n);t.children.push(a)}}function N(e,t){var n=[];n[0]=e.trim();var r=[];if(t)for(var i=t.split("|"),o=0;o<i.length;o++){var a=i[o].split(":");r.push({name:a[0].trim(),param:a.slice(1)})}return n[1]=r,n}function A(e,t,n){var r="";if(1===e.type){var i,o;e["for"]&&(i="forScope"+Le++,n=n.concat(i)),o="["+n.toString()+"]";var a="";if(_t[e.tag])a=JSON.stringify([e.children,e.slotMap]);else{for(var s=0;s<e.children.length;s++){var c=e.children[s-1];a+=","+A(e.children[s],c?c["if"]:null,n)}a.length>0&&(a=a.substr(1))}var l=C(e.attrNodes),u=l[0],f=l[1],h=e["if"]||"true";h="("+h+")",t&&e["else"]&&(h="!("+t+")");var p=e.html||"null",d=h+'?_ce(this,"'+e.tag+'",'+u+","+f+",["+a+"],"+p;if("template"==e.tag&&(d=h+"?_tmp(["+a+"]"),e["for"]){var v=(e["for"][0]||"").trim(),m=e["for"][1].trim(),_=e["for"][2],g=e["for"][3],b=e["for"][4],y=g;b&&(y="(function(){var rs=[];for(var i="+g+";i<="+b+";i++)rs.push(i);return rs;}).call(this)"),_&&(y="_fi("+y+","+k(_)+")"),r+="_li("+y+",function("+i+"){ with("+i+"){return "+d+","+o+'):null}},this,"'+v+'","'+m+'")'}else r+=d+","+o+"):null"}else{var w=F(e.txtQ);r+="_ct("+w+")"}return r}function C(e){var t={},n="";for(var r in e){var i=e[r];if(i.directive){var o=i.value;n+=",['"+r+"',"+JSON.stringify(i.directive)+","+("on"===i.directive[0]?JSON.stringify(o):o)+","+JSON.stringify(o)+"]"}else t[r]=i.value}return[JSON.stringify(t),"["+n.substr(1)+"]"]}function F(e){var t="";return e.forEach(function(e){if(e instanceof Array){var n=e[0],r=e[1];t+=r.length>0?"+_fi("+n+","+k(r)+")":"+"+n}else e&&(t+="+"+JSON.stringify(e))}),t=t.replace(/\n/gm,""),t.length>0&&(t=t.substr(1)),t}function k(e){var t="";return e.forEach(function(e){var n='["'+e.name+'",['+e.param.toString()+"]]";t+=","+n}),"["+t.substr(1)+"]"}function T(e,t){if(ke[e]&&!t.__slots&&!t.__slotMap)return ke[e];var n="with($global){with(comp){with(state){return "+j(e,t,[])+"}}}";return n=new Function("$global,comp,state,_ce,_tmp,_ct,_li,_fi",n),ke[e]=n,n}function j(e,t,n){var r=Date.now(),i=O(e);console.log("parse time",Date.now()-r);var o=i[0];if(o.length>1)throw new Error("should only have one root");var a=o[0];if(1!=a.type||"template"==a.tag||"slot"==a.tag||a["for"])throw new Error("root element cannot be <template> or <slot>");if(_t[a.tag])throw new Error("root element <"+a.tag+"> should be a non-component tag");pe(i[1],t.__slots,t.__slotMap);var r=Date.now(),e=A(a,null,n);return console.log("build time",Date.now()-r),e}function P(e){var t=null;try{var n=T(e.compiledTmp,e);t=n.call(e,wt.$global,e,e.state,d,v,m,_,g)}catch(r){Se(e.name,"compile error -> "+r.message)}return t}function M(e,t,n){return $e={},R(e,t)?B(e,t,n):($(e,t,t.parent?t.parent.children:null,t.parent,n),Q(t)),$e}function B(e,t,n){if(e._comp)return void($e[t._cid]=e._forScopeQ);if(e.tag){for(var r=!1,i=e._directives.length;i--;){var o=e._directives[i],a=t._directives[i];if(!a||o[2]!==a[2]){r=!0;break}}if(!r){var s=Object.keys(e.attrNodes);if(s.length!=Object.keys(t.attrNodes).length)r=!0;else for(var i=s.length;i--;){var c=s[i];if(e.attrNodes[c]!=t.attrNodes[c]){r=!0;break}}}r&&e._directives.forEach(function(t){var n=t[1][0];if("on"!==n){var r=vt[n];if(r){var i=t[1][1],o=t[2],a=t[3];r.onBind&&r.onBind(e,{value:o,args:i,exp:a})}}}),J(e,t),t._forScopeQ&&(t._forScopeQ=e._forScopeQ)}else e.txt!==t.txt&&q(e,t);e.children&&t.children?L(e.children,t.children,t,n):e.children?D(t,e.children,n):t.children&&t.children.length>0&&Q(t.children)}function L(e,t,n,r){if(e.length<1)return void(t.length>0&&Q(t));for(var i=0,o=t.length-1,a=0,s=e.length-1,c=t[0],l=t[o],u=e[0],f=e[s];o>=i&&s>=a;)R(u,c)?(B(u,c,r),c=t[++i],u=e[++a]):R(f,l)?(B(f,l,r),l=t[--o],f=e[--s]):R(f,c)?($(c,V(l),t,n,r),c=t[i],o--,f=e[--s]):R(u,l)?($(l,c,t,n,r),l=t[o],i++,u=e[++a]):u.getAttribute("xid")||($(u,c,t,n,r),Q(c),c=t[++i],u=e[++a]);if(o>=i&&o>0){var h=t.splice(i,o-i+1);h.length>0&&Q(h)}if(s>=a){var p=a==s?[e[a]]:e.splice(a,s-a+1);p.length>0&&$(p,t[i],t,n,r)}}function $(e,t,n,i,o){if(n){if(e.dom){var a=n.indexOf(e);a>-1&&n.splice(a,1)}var s=i;if(t)if(a=n.indexOf(t),s=s||t.parent,r(e)){for(var c=e.length;c--;)e[c].parent=s;var l=[a,0].concat(e);n.splice.apply(n,l)}else e.parent=s,n.splice(a,0,e);else r(e)?e.forEach(function(e){n.push(e),e.parent=s}):(e.parent=s,n.push(e))}var u=e.dom,f=[];if(u)u.parentNode.removeChild(u);else if(r(e)){for(var h=document.createDocumentFragment(),a=0;a<e.length;a++){var p=e[a],d=se(p,o);p._comp&&(fe(p._comp),f.push(p._comp)),h.appendChild(d)}u=h}else u=se(e,o),e._comp&&(fe(e._comp),f.push(e._comp));if(t){var v=t.dom;v.parentNode.insertBefore(u,v)}else i.dom.appendChild(u);for(var a=0;a<f.length;a++){var d=f[a];d.__url||me(d,i)}}function V(e){var t=e.parent,n=t.children.indexOf(e);return t.children[n+1]}function Q(e){r(e)||(e=[e]);for(var t=e[0].parent,n=e.length;n--;){var i=e[n],o=t.children.indexOf(i);o>-1&&t.children.splice(o,1);var a=i.dom.parentNode;a&&a.removeChild(i.dom),wt._cs[i._cid]&&i.getAttribute(ht)&&wt._cs[i._cid].destroy()}}function D(e,t,n){e.children=t;for(var r=document.createDocumentFragment(),i=[],o=0;o<t.length;o++){var a=t[o],s=se(a,n);a._comp&&(fe(a._comp),i.push(a._comp)),r.appendChild(s)}e.dom.appendChild(r);for(var o=0;o<i.length;o++){var c=i[o];me(c,e)}}function R(e,t){return e._comp?t.getAttribute(ht)==e.tag?!0:!1:t.tag===e.tag}function q(e,t){t.txt=e.txt;var n=t.dom;n.textContent=e.txt}function J(e,t){for(var i=e.attrNodes,o=t.attrNodes,a=Object.keys(i),s=Object.keys(o),c=t.dom,l="input"===t.tag,u=a.length;u--;){var f=a[u],h=s.indexOf(f);0>h?(c.setAttribute(f,i[f]),l&&"value"===f&&(c.value=i[f])):(i[f]!=o[f]&&(c.setAttribute(f,i[f]),l&&"value"===f&&(c.value=i[f])),s.splice(h,1))}for(var u=s.length;u--;)s[u]!==ht&&c.removeAttribute(s[u]);var p=t.attrNodes[ht];t.attrNodes=e.attrNodes,p&&(t.attrNodes[ht]=p),t._directives=e._directives,t._directives.forEach(function(e){(r(e[2])||n(e[2]))&&(e[2]=JSON.parse(JSON.stringify(e[2])))})}function z(e,t){var n=t.target;do{var r=n._vid;if(void 0!==r){var i=gt[e];if(i){var o=i[r];if(o){var a=o[0];if("mouseleave"==e){var s=t.target;if(!U(a.dom,s))return;var c=t.toElement||t.relatedTarget;if(U(a.dom,c))return}var l=o[1],u=o[2],f=o[3],h=wt._cs[u];if(f)l.call(h,t,a);else{var p=[wt.$global,h,h.state,t,a];if(a._forScopeQ)for(var d=0;d<a._forScopeQ.length;d++)p.push(a._forScopeQ[d]);l.apply(h,p)}}}}}while((n=n.parentNode)&&"BODY"!=n.tagName)}function U(e,t){if(e.contains)return e.contains(t);do{if(e==t)return!0;t=t.parentNode}while(t&&"BODY"!=t.tagName);return!1}function Z(e){z("touchstart",e),z("pointerdown",e),ze=setTimeout(function(){z("press",e)},800),Ye=!1,He=!1;var t=e.touches[0];Ue={x:t.clientX,y:t.clientY,t:Date.now()}}function X(e){clearTimeout(ze),z("touchmove",e),z("pointermove",e),Ye=!0}function Y(e){clearTimeout(ze),He=!0,z("touchcancel",e),z("pointercancel",e)}function H(e){if(clearTimeout(ze),z("touchend",e),z("pointerup",e),!He)if(Ye){var t=e.changedTouches[0],n=t.clientX,r=t.clientY,i=Ue,o=i.x,a=i.y,s=i.t,c=Date.now()-s,l=Math.sqrt((n-o)*(n-o)+(r-a)*(r-a))>>0;if(Ze>=c&&l>20){var u=Math.atan2(r-a,n-o),f={slope:u,interval:c,distance:l};z("fling",e,f)}}else z("tap",e),Date.now()-Xe<300&&z("dbltap",e),Xe=Date.now()}function W(e){z("mousedown",e),z("pointerdown",e),ze=setTimeout(function(){z("press",e)},800)}function I(e){clearTimeout(ze),z("mousemove",e),z("pointermove",e)}function G(e){clearTimeout(ze),z("mouseup",e),z("pointerup",e),0===e.button&&(z("click",e),z("tap",e),Date.now()-Ie<300&&(z("dblclick",e),z("dbltap",e)),Ie=Date.now())}function K(e){clearTimeout(ze),z("pointercancel",e)}function ee(e){z("mouseout",e),z("mouseleave",e)}function te(e){z("mouseover",e)}function ne(e){z("mousewheel",e)}function re(e,t,n,r,i,o){this.name=e,this.newVal=t,this.oldVal=n,this.path=r,this.type=i,this.object=o}function ie(){this.__eeMap={}}function oe(e){ie.call(this),this._uid="C_"+pt++,this.el=e,this.refs={},this.compTags={},this.input=null,this.name,this.parent,this.children=[],this.__watchMap={},this.__watchFn,this.__watchOldVal,this.__watchPaths=[],this.__syncFn={},this.__syncOldVal={},this.__syncFnForScope={},this.template,this.__url,this.state={},wt._cs[this._uid]=this}function ae(){}function se(e,t){var n,r=t._uid;if(o(e.txt)){if(n=document.createElement(e.tag),n._vid=e.vid,e._cid=r,!e._comp){var i=e._directives;i&&i.length>0&&i.forEach(function(n){var r=n[1][0],i=vt[r];if(i){var o=n[1][1],a=n[2],s=n[3];i.onBind&&i.onBind(e,{comp:t,value:a,args:o,exp:s})}})}for(var a in e.attrNodes)a[0]!==ut&&n.setAttribute(a,e.attrNodes[a]);if(e.attrNodes[at]&&(t.refs[e.attrNodes[at]]=n),e._comp){var s=be(e,e.tag,n,t,e._slots,e._slotMap,e.attrNodes);e._comp=s}else if(e.children&&e.children.length>0)for(var c=0;c<e.children.length;c++){var s=se(e.children[c],t);n.appendChild(s)}}else n=document.createTextNode(ce(e.txt));return e.dom=n,n}function ce(e){return e.replace?e.replace(/&lt;/gim,"<").replace(/&gt;/gim,">").replace(/&nbsp;/gim," ").replace(/&amp;/gim,"&"):e}function le(e,t,n){if(o(e.txt)&&!e._comp){var r=e._directives;if(r&&r.length>0&&r.forEach(function(r){var i=r[1][0],o=vt[i];if(o){var a=r[1][1],s=r[2],c=r[3];0==n?(mt[i+"."+c]=s,o.onActive&&o.onActive(e,{comp:t,value:s,args:a,exp:c},e.dom)):mt[i+"."+c]!=s&&(o.onUpdate&&o.onUpdate(e,{comp:t,value:s,args:a,exp:c},e.dom),mt[i+"."+c]=s)}}),e.children&&e.children.length>0)for(var i=0;i<e.children.length;i++)le(e.children[i],t,n)}}function ue(e,t){if(t){var n=de(e,t);if(!bt[e]){if(n.trim().length>0){var r=document.head.children[0];r?r.insertAdjacentHTML("afterend","<style>"+n+"</style>"):document.head.innerHTML="<style>"+n+"</style>"}bt[e]=!0}}}function fe(e){e.__url?u(e.name,e.__url,function(n,r){_t[e.name]=n,t(n,e),a(n.state)?e.state=n.state.call(e):n.state&&(e.state={},t(n.state,e.state)),he(e.template,e),e.onCreate&&e.onCreate(),ye(e,e.parent,e.__attrs),ue(e.name,r),e.__attrs=e.__url=null,ve(e),me(e,e.parent?e.parent.vnode:null)}):(e.template&&he(e.template,e),ve(e))}function he(e,t){t.onBeforeCompile&&(e=t.onBeforeCompile(e)),t.compiledTmp=e.trim().replace(/<!--[\s\S]*?-->/gm,"").replace(/<\s*script[\s\S]*?<\s*\/\s*script\s*>/gm,"").replace(/^\s+|\s+$/gim," ").replace(/>\s([^<]*)\s</,function(e,t){return">"+t+"<"})}function pe(e,t,n){(t||n)&&e.forEach(function(e){var r=e[0],i=e[1],o=e[2],a=r.children.indexOf(i),s=[a,1];o?n[o]&&s.push(n[o]):s=s.concat(t),r.children.splice.apply(r.children,s)})}function de(e,t){t=t.replace(/\n/gim,"").trim();for(var n=!1,r="",i="",o={},a=[],s=0;s<t.length;s++){var c=t[s];if(n)"}"===c&&(n=!1,o.body=i.trim(),r="",a.push(o),o={}),i+=c;else{if("{"===c){n=!0,o.selector=r.trim(),i="";continue}r+=c}}var l="";return e="["+ht+'="'+e+'"]',a.forEach(function(t){for(var n=t.selector.split(","),r="",i=0;i<n.length;i++){var o=n[i].trim();r+=0===o.indexOf(":host")?","+o.replace(/:host/,e):","+e+" "+o}r=r.substr(1),l+=r+"{"+t.body+"}"}),l}function ve(e){var t=P(e),n=null;if(e.vnode){n=e.vnode.parent;var r=n.children,i=r.indexOf(e.vnode);i>-1&&r.splice(i,1,t)}e.vnode=t,t.parent=n,e.state=Ce.observe(e.state,e),e.onCompile&&e.onCompile(e.vnode)}function me(e,t){var n=se(e.vnode,e);e.onBeforeMount&&e.onBeforeMount(n),e.el.parentNode.replaceChild(n,e.el),e.el=n;for(var r=e.children.length;r--;)fe(e.children[r]);for(var r=0;r<e.children.length;r++)e.children[r].__url||me(e.children[r],e.vnode);e.name&&(e.el.setAttribute(ht,e.name),e.vnode.setAttribute(ht,e.name)),e.onMount&&e.onMount(e.el),e.vnode.parent=t,le(e.vnode,e,0)}function _e(e,t){var r=!0;if(e.onBeforeUpdate&&(r=e.onBeforeUpdate(t)),r!==!1){for(var i=P(e),o=M(i,e.vnode,e,o),a=0;a<e.children.length;a++){var s=e.children[a];s.compiledTmp||(fe(s),s.__url||me(s,e.vnode))}if(e.__watchFn){var c=e.__watchFn(e.state);for(var l in c){var u=c[l],f=e.__watchOldVal[l];(u!==f||n(u))&&e.__watchMap[l].call(e,u,f,l)}e.__watchOldVal=c}for(var h in e.__syncFn){var p=[e.state];o[h]&&(e.__syncFnForScope[h]=o[h]);var d=e.__syncFnForScope[h];if(d)for(var a=0;a<d.length;a++)p.push(d[a]);var v=e.__syncFn[h].apply(e,p);wt._cs[h].onPropChange&&wt._cs[h].onPropChange(v,e.__syncOldVal[h]),e.__syncOldVal[h]=v}e.onUpdate&&e.onUpdate(t),le(e.vnode,e)}}function ge(e,n,r){var i=new oe(n);return i.template=e,i.name="ROOT",r&&(t(r,i),a(r.state)&&(i.state=r.state.call(i))),i.onCreate&&i.onCreate(),i}function be(e,n,r,o,s,c,l){"component"==n&&(n=l.is,l[".is"]&&(n=l[".is"],n=new Function("scope","with(scope){return "+n+"}")(o.state)));var u=_t[n];if(u){var f=new oe(r);return f.name=n,o.children.push(f),f.parent=o,f.vnode=e,l[at]&&(o.refs[l[at]]=f),l[st]&&(wt.id[l[st]]=f),e._directives.forEach(function(e){var t=e[1][0];if("on"===t){var n=e[1][1][0],r=e[2];r.match(/(?:^|this\.)([a-zA-Z_][a-zA-Z0-9_$]*)(?:\(|$)/);var i=RegExp.$1,a=o[i]||wt.$global[i];a&&f.on(n,a.bind(o))}}),f.__attrs=l,f.__slots=s,f.__slotMap=c,i(u)?(f.__url=u,f):(u&&(t(u,f),a(u.state)?f.state=u.state.call(f):u.state&&(f.state={},t(u.state,f.state))),f.onCreate&&f.onCreate(),ye(f,o,l),f)}}function ye(e,t,n){var r={},i=e.input;if(i)for(var a in i){var s=i[a];s.require&&(r[a]=We),!o(s.value)&&o(e.state[a])&&(e.state[a]=s.value)}n&&we(n,e,t,i,r);var c=Object.keys(r);return c.length>0?void Se(e.name,"input args ["+c.join(",")+"] are required"):void 0}function we(e,r,i,o,a){var s="",c={};for(var l in e){var u=e[l];if(l!=at)if(l=l.replace(/-[a-z0-9]/g,function(e){return e[1].toUpperCase()}),l[0]===ct){var f=l.substr(1);i[u]instanceof Function&&(u="this."+u),s+=","+JSON.stringify(f)+":"+u}else c[l]=u}s=s.substr(1);var h={};if(s){var p="",d="",v=r.vnode,m=[i.state],_=i.__syncFnForScope[r._uid]=[];if(v._forScopeQ)for(var g=0;g<v._forScopeQ.length;g++)p+="with(arguments["+(1+g)+"]){",d+="}",m.push(v._forScopeQ[g]),_.push(v._forScopeQ[g]);var b=i.__syncFn[r._uid]=new Function("scope","with(scope){"+p+"return {"+s+"}"+d+"}");h=i.__syncOldVal[r._uid]=b.apply(i,m)}var y=[];t(c,h);for(var l in h){var u=h[l];n(u)&&u.__im__oid&&y.push(l),o&&l in o&&(delete a[l],xe(l,u,o,r))}if(y.length>0&&Oe(r.name,"dynamic attribute '"+y.join(",")+"' should be read only"),r.onPropBind)r.onPropBind(h);else for(var l in h){var u=h[l];u instanceof Function?r[l]=u:r.state[l]=u}}function xe(e,t,n,r){if(n[e]&&n[e].type){var i=n[e].type;i=i instanceof Array?i:[i];var o=typeof t;t instanceof Array&&(o="array"),"undefined"!==o&&i.indexOf(o)<0&&Se(r.name,"invalid type ["+o+"] of input arg ["+e+"];should be ["+i.join(",")+"]")}}function Oe(e,t){console&&console.warn("XWARN C["+e+"] - "+t)}function Se(e,t){console&&console.error("XERROR C["+e+"] - "+t)}function Ee(e,t,n){var r=(e.target||e.srcElement).value,i=t.getAttribute("number");o(i)||(r=parseFloat(r));var a=t.getAttribute("debounce");if(a){t.debounceTimer&&(clearTimeout(t.debounceTimer),t.debounceTimer=null);var s=this;t.debounceTimer=setTimeout(function(){clearTimeout(t.debounceTimer),t.debounceTimer=null,s.setState(t.exp,r)},a)}else this?this.setState(t.exp,r):n.setState(t.exp,r)}function Ne(e,t,n){var i=e.target||e.srcElement,o=i.value,a="with(scope){return "+t.exp+"}",s=new Function("scope",a),c=null;if(c=s(this?this.state:n.state),r(c)||(c=[c]),i.checked)c.push(o);else{var l=c.indexOf(o);l>-1&&c.splice(l,1)}}var Ae={},Ce=null;window.Proxy&&!function(){function e(e,t,n){isNaN(t)||(e[t>>0]=n)}function t(e,t){isNaN(t)||e.splice(t,1)}function i(e,t,o,a){if(o&&o.__im__propChain)return o;var s=r(o)?[]:{};for(var c in o){var l=o[c];if(n(l)){var u=t.concat();u.push(c);var f=i(e,u,l,a);s[c]=f}else s[c]=l}Object.defineProperty(s,"__im__propChain",{enumerable:!1,writable:!1,value:t});var h=new Proxy(s,e),p=Date.now()+Math.random();return Object.defineProperty(s,"__im__oid",{enumerable:!1,writable:!1,value:p}),h}Ce={observe:function(o,a){if(o&&o.__im__propChain)return o;var s={comp:a,set:function(t,o,a){var s=!(o in t),c=t[o],l=a;if(c===l)return!0;if(n(l)){var u=t.__im__propChain.concat();u.push(o),l=i(this,u,l,this.comp)}r(t)?e(t,o,l):t[o]=l;var f=t.__im__propChain,h={object:t,name:o,pc:f,oldVal:c,newVal:l,comp:this.comp,type:s?"add":"update"};return Ke.handle(h),!0},deleteProperty:function(e,n){var i=e[n];r(e)?t(e,n):delete e[n];var o=e.__im__propChain,a={object:e,name:n,pc:o,oldVal:i,comp:this.comp,type:"delete"};return Ke.handle(a),!0}};return i(s,[],o,a)}}}(),!window.Proxy&&!function(){function e(e){return this.__im__innerProps[e]}function t(e,t){var r=this.__im__innerProps[e];if(r&&a(r),n(t)){var o=this.__im__propChain.concat();o.push(e),t=i(o,t,this.__im__comp)}this.__im__innerProps[e]=t;this.__im__propChain;s([{name:e,target:this,oldVal:r,newVal:t,type:"update"}],!0)}function i(o,a,s){if(a&&a.__im__propChain)return a;var l=r(a)?[]:{};Object.defineProperty(l,"__im__innerProps",{enumerable:!1,writable:!0,value:{}});var u={},f={};for(var h in a)if(a.hasOwnProperty(h)){var p=a[h];if(n(p)){var d=o.concat();d.push(h);var v=i(d,p,s);l.__im__innerProps[h]=v}else l.__im__innerProps[h]=p;f[h]=p,!function(n){u[n]={get:function(){return e.call(this,n)},set:function(e){t.call(this,n,e)},enumerable:!0,configurable:!0}}(h)}Object.defineProperties(l,u),Object.defineProperty(l,"__im__propChain",{enumerable:!1,writable:!1,value:o}),Object.defineProperty(l,"__im__comp",{enumerable:!1,writable:!1,value:s});var m=Date.now()+Math.random();return Object.defineProperty(l,"__im__oid",{enumerable:!1,writable:!1,value:m}),c.push({snap:f,now:l,id:m}),l}function o(){l(function(){for(var e=c.length;e--;){var t=c[e],n=t.snap,r=t.now,i=(t.id,[]);for(var a in n)if(!(a in r)){var l={};l.name=a,l.target=r,l.oldVal=n[a],l.snap=n,l.type="delete",i.push(l)}for(var a in r)if(!(a in n)){var l={};l.name=a,l.target=r,l.newVal=r[a],l.snap=n,l.type="add",i.push(l)}i.length>0&&s(i)}o()})}function a(e){for(var t=null,r=c.length;r--&&(t=c[r],t.id!==e.__im__oid););r>-1&&(c.splice(r,1),n(t)&&a(t))}function s(r,o){for(var s=r.length;s--;){var c=r[s],l=c.name,u=c.target,f=u.__im__propChain,h=u.__im__comp,p=c.oldVal,d=c.newVal,v=c.type,m=c.snap;if("add"===v){if(m[l]=d,u.__im__innerProps[l]=d,n(d)){var _=f.concat();_.push(l),u.__im__innerProps[l]=i(_,d,h)}!function(n,r){Object.defineProperty(r,n,{get:function(){return e.call(this,n)},set:function(e){t.call(this,n,e)},enumerable:!0,configurable:!0})}(l,u)}else if("delete"===v){var g=m[l];n(g)&&a(g),delete m[l]}else if(!o){console.log("无效update");continue}var b={object:u,name:l,pc:f,oldVal:p,newVal:d,comp:h,type:v};Ke.handle(b)}}var c=[],l=function(e){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||function(t){return e.setTimeout(function(){t(Date.now())},16.7)}}(self);Ce={},Ce.observe=function(e,t){return e&&e.__im__propChain?e:i([],e,t)},o()}();var Fe=0;p.prototype={on:function(e,t){var n=gt[e];n||(n=gt[e]={});var r=!1;if(a(t)&&(r=!0),r)n[this.vid]=[this,t,this._cid,r];else{var i="",o="";if(this._forScopeQ)for(var s=0;s<this._forScopeQ.length;s++)i+="with(arguments["+(5+s)+"]){",o+="}";n[this.vid]=[this,new Function("$global,comp,state,$event,$vnode","with($global){with(comp){with(state){"+i+t+o+"}}}"),this._cid]}},setAttribute:function(e,t){return this.attrNodes[e]=t,this},getAttribute:function(e){return this.attrNodes[e]}};var ke=[],Te=["br","hr","img","input","link","meta","area","base","col","embed","keygen","param","source","track","wbr"],je=/<([-a-z0-9]+)((?:\s+[-a-zA-Z0-9_:.]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')))?)*)\s*(?:\/?)>/im,Pe=/[a-zA-Z_:.][-a-zA-Z0-9_:.]*(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?/gim,Me=/<\/([-a-z0-9]+)>/im,Be=/<\/([-a-z0-9]+)>/gim,Le=0,$e=null,Ve=self.navigator.userAgent.toLowerCase(),Qe=Ve.indexOf("android")>0?!0:!1,De=Ve.indexOf("iphone")>0?!0:!1,Re=Ve.indexOf("ipad")>0?!0:!1,qe=Ve.indexOf("windows phone")>0?!0:!1,Je=De||Re||Qe||qe;if(Je){var ze,Ue,Ze=200,Xe=0,Ye=!1,He=!1;document.addEventListener("touchstart",Z,!0),document.addEventListener("touchmove",X,!0),document.addEventListener("touchend",H,!0),document.addEventListener("touchcancel",Y,!0)}else{document.addEventListener("mousedown",W,!0),document.addEventListener("mousemove",I,!0),document.addEventListener("mouseup",G,!0),window.addEventListener("blur",K,!0);var We=null==self.onmousewheel?"mousewheel":"DOMMouseScroll";document.addEventListener(We,ne,!0),document.addEventListener("mouseout",ee,!0),document.addEventListener("mouseover",te,!0);var ze,Ie=0}document.addEventListener("input",function(e){z("input",e)},!0),document.addEventListener("change",function(e){z("change",e)},!0),document.addEventListener("keydown",function(e){z("keydown",e)},!0),document.addEventListener("keypress",function(e){z("keypress",e)},!0),document.addEventListener("keyup",function(e){z("keyup",e)},!0),document.addEventListener("focus",function(e){z("focus",e)},!0),document.addEventListener("blur",function(e){z("blur",e)},!0);var Ge=null==self.onwheel?"wheel":"mousewheel";document.addEventListener(Ge,function(e){z("wheel",e)},!0),document.addEventListener("scroll",function(e){z("scroll",e)},!0);var Ke=new function(){function e(e){for(var t=i.length;t--;){var n=i[t];if(n.object.__im__oid===e.object.__im__oid&&n.name===e.name)break}t>-1?i.splice(t,1,e):i.push(e)}function t(e,t,n,i,a,s,c){var l=[];if(l=c.concat(),r(s)||l.push(a),n){o[n._uid]||(o[n._uid]={changes:[],comp:n});var u=new re(a,e,t,l,i,s);o[n._uid].changes.push(u)}}var n=!1,i=[],o={};this.handle=function(r){n?e(r):(i=[],o={},n=!0,i.push(r),setTimeout(function(){n=!1,i.forEach(function(e){var n=e.comp,r=e.newVal,i=e.oldVal,o=e.pc,a=e.type,s=e.name,c=e.object;t(r,i,n,a,s,c,o)});var e=o;for(var r in e)_e(e[r].comp,e[r].changes)},20))}};ie.prototype={on:function(e,t,n){return this.__eeMap[e]=[t,n||this],this},emit:function(e){var t=this.__eeMap[e],n=t[0],r=t[1];if(n){for(var i=[],o=1;o<arguments.length;o++)i.push(arguments[o]);n.apply(r,i)}}},ae.prototype=ie.prototype,oe.prototype=new ae,oe.prototype.constructor=oe.constructor,t({setState:function(e,t){t=JSON.stringify(t);var n="with(scope){"+e+"="+t+"}",r=new Function("scope",n);return r(this.state),this},watch:function(e,t){this.__watchPaths.push(e);for(var n="",r=this.__watchPaths.length;r--;){var i=this.__watchPaths[r];n+=","+JSON.stringify(i)+":"+i}n=n.substr(1);var o=this.__watchFn=new Function("scope","with(scope){return {"+n+"}}");return this.__watchOldVal=o(this.state),this.__watchMap[e]=t,this},destroy:function(){if(this.onDestroy&&this.onDestroy(),this.parent){this.parent.__syncFn[this._uid]=null,this.parent.__syncOldVal[this._uid]=null,this.parent.__syncFnForScope[this._uid]=null,delete this.parent.__syncFn[this._uid],delete this.parent.__syncOldVal[this._uid],delete this.parent.__syncFnForScope[this._uid];var e=this.parent.children.indexOf(this);e>-1&&this.parent.children.splice(e,1),this.parent=null}for(;this.children.length>0;)this.children[0].destroy();this.children=wt._cs[this._uid]=null,delete wt._cs[this._uid],this.refs=this.__nodes=this.__syncFn=this._uid=this.__url=this.template=this.state=null},onPropChange:function(e,t){for(var n in e){var r=e[n];r!==this.state[n]&&(this.state[n]=r)}}},oe.prototype);var et="x-",tt=":",nt=".",rt="{{",it="}}",ot=/^x-.*/,at="ref",st="id",ct=".",lt=":",ut=".",ft=new RegExp(rt+"(.+?)(?:(?:(?:=>)|(?:=&gt;))(.+?))?"+it,"img"),ht="impex-component",pt=0,dt={},vt={},mt={},_t={component:1},gt={},bt={},yt=!0,wt=new function(){this.$global={},this.id={},this.version={v:[0,96,0],state:"alpha",toString:function(){return wt.version.v.join(".")+" "+wt.version.state}},this.website="http://impexjs.org",this.config=function(e){var t=e.delimiters||[];rt=t[0]||"{{",it=t[1]||"}}",yt=e.showWarn===!1?!1:!0,ft=new RegExp(rt+"(.+?)(?:(?:(?:=>)|(?:=&gt;))(.+?))?"+it,"img")},this.component=function(e,t){return"string"==typeof t||t.template||Se(e,"can not find property 'template'"),_t[e]=t,this},this.directive=function(e,t){return vt[e]=t,this},this.filter=function(e,t){return dt[e]=t,this},this.renderTo=function(e,t,n){for(var r=document.querySelectorAll('link[rel="impex"]'),o=r.length;o--;){var a=r[o],s=a.getAttribute("type"),c=a.getAttribute("href");wt.component(s,c)}if(i(t)&&(t=document.querySelector(t)),"BODY"===t.tagName)return void Se("ROOT","container element must be inside <body> tag");var l=ge(e,t,n);return fe(l),me(l),l},this.render=function(e,t){i(e)&&(e=document.querySelector(e));var n=e.outerHTML;return this.renderTo(n,e,t)},Object.defineProperty(this,"_cs",{enumerable:!1,writable:!0,value:{}}),this.Component=oe,this.EventEmitter=ie};wt.directive("style",{onBind:function(e,t){var n=t.value;if(i(n)){for(var r={},o=n.split(";"),a=o.length;a--;)if(o[a]){var s=o[a].split(":");r[s[0]]=s[1]}n=r}var c=e.getAttribute("style")||"";for(var l in n){var u=this.filterName(l),f=n[l];u=u.replace(/[A-Z]/gm,function(e){return"-"+e.toLowerCase()}),c+=u+":"+f+";"}e.setAttribute("style",c)},filterName:function(e){return e.replace(/-([a-z])/gim,function(e,t){return t.toUpperCase()})}}).directive("class",{onBind:function(e,t){var n=t.value,o=e.getAttribute("class")||"";if(i(n))o+=" "+n;else if(r(n))o+=" "+n.join(" ");else for(var a in n){var s=n[a];s&&(o+=" "+a)}e.setAttribute("class",o)}}).directive("on",{onBind:function(e,t){for(var n=t.args,r=n.length;r--;)e.on(n[r],t.value)}}).directive("bind",{onBind:function(e,t){var n=t.args;(!n||n.length<1)&&Oe("at least one attribute be binded");for(var r=n.length;r--;){var i=n[r];switch(i){case"style":vt[i].onBind(e,t);break;case"class":vt[i].onBind(e,t);break;default:e.setAttribute(i,t.value)}}}}).directive("show",{onBind:function(e,t){var n=t.value,r=e.getAttribute("style")||"";r+=n?";display:;":";display:none;",e.setAttribute("style",r)}}).directive("cloak",{}).directive("model",{onBind:function(e,t){e.exp=t.exp,e.on("change",this.handleChange),e.on("input",Ee)},handleChange:function(e,t){{var n=e.target,r=n.tagName.toLowerCase();n.value}switch(r){case"textarea":case"input":var i=n.getAttribute("type");switch(i){case"radio":Ee(e,t,this);break;case"checkbox":Ne(e,t,this)}break;case"select":var o=n.getAttribute("multiple");if(null!==o){for(var a=[],s=n.options.length;s--;){var c=n.options[s];c.selected&&a.push(c.value)}this.setState(t.exp,a)}else Ee(e,t,this)}}}),wt.filter("json",function(e){return JSON.stringify(e)}).filter("filterBy",function(e,t,n){var i=e;if(!r(i))return console.warn("can only filter array"),e;var o=[];if(a(t))for(var s=i.length;s--;){var c=t.call(this,i[s]);c&&o.unshift(i[s])}else for(var s=i.length;s--;){var l=i[s];n?(!t||(l[n]+"").indexOf(t)>-1)&&o.unshift(l):(!t||l.indexOf&&l.indexOf(t)>-1)&&o.unshift(l)}return o}).filter("limitBy",function(e,t,n){return r(e)?t?e.splice(n||0,t):e:(console.warn("can only filter array"),e)}).filter("orderBy",function(e,t,n){return t||n?r(e)?(e.sort(function(e,n){
var r=t?e[t]:e,i=t?n[t]:n;return"string"==typeof r?r.localeCompare(i):"number"==typeof r?r-i:(r+"").localeCompare(i)}),"desc"===n&&e.reverse(),e):(console.warn("can only filter array"),e):e}),"object"==typeof module&&"object"==typeof module.exports?module.exports=wt:e.impex=wt}(window||this);