/*
 * impexjs is a powerful web application engine to build 
 * reactive webUI system
 *
 *
 * Copyright 2015-2019 MrSoya and other contributors
 * Released under the MIT license
 *
 * website: http://impexjs.org
 * last build: 2019-2-11
 */
!function(e){"use strict";function t(e,t,n,r){console&&console.error("xerror["+e+"] - #"+t+" - "+n,r||"","\n\nFor more information about the xerror,please visit the following address: http://impexjs.org/doc/techniques.html#techniques-xerror")}function n(e,n,r,i,o){!e&&t(n,r,i,o)}function r(e,t){for(var n=Object.keys(e),r=n.length;r--;){var i=n[r];t[i]=e[i]}}function i(e){return"object"==typeof e&&null!==e}function o(e){return Array.isArray(e)}function a(e){return"string"==typeof e}function s(e){return void 0===e}function c(e){return e instanceof Function}function u(e){for(var t,r,i=null,o=[],a=[],s=[],c=[];e.length>0;){if(!i){i=Ve.exec(e),n(i,a.length<1?"ROOT":a[a.length-1],qe.COMPILE.HTML,"html template compile error - syntax error in - \n"+e);var u=i.index+i[0].length;e=e.substr(u)}var f=i[1],p=new z(f);p.outerHTML=i[0],p.innerHTML=e;var d=o[o.length-1];d?d.children.push(p):s.push(p),ze[f]&&(r=p,a.push(p));var v=i[2].trim(),m=v.match(Ze);if(m&&l(m,p,r),e.length<1)break;if(f===Xe)c.push([d,p,p.attributes.name?p.attributes.name:null]);else if(p.attributes.slot){var g=r;g===p&&(g=a[a.length-1-1]),g&&(g.slotMap[p.attributes.slot]=p)}Je.indexOf(f)<0?o.push(p):p.innerHTML="";var b=Ve.exec(e);b&&(i=b),t=Ge.exec(e);var y=t?t.index:-1,_=b?b.index:-1;if(d=o[o.length-1],_>-1&&y>_)h(e.substr(0,_),d),e=e.substr(_+b[0].length);else{h(e.substr(0,y),d);var O=y+t[0].length;We.lastIndex=0,We.exec(e);do{var E=o.pop();if(E===r&&(a.pop(),r=a[a.length-1]),E===p)if(p.innerHTML==t.input)p.innerHTML=t.input.substring(0,t.index);else{var w=p.innerHTML.replace(t.input,"");p.innerHTML=w+t.input.substring(0,t.index)}if(o.length<1)break;t=We.exec(e),n(t,a.length<1?"ROOT":a[a.length-1],qe.COMPILE.HTML,"html template compile error - there's no end tag of <"+f+"> - \n"+e),y=t.index;var $=e.substring(O,t.index);if($.trim()){if(y>_){var E=Ve.exec($);E&&($=$.substr(0,E.index).trim())}$.trim()&&(p=o[o.length-1],h($,p))}O=y+t[0].length}while(_>y);if(!b)break;e=e.substr(_+b[0].length)}}return[s,c]}function l(e,t,n){for(var r=e.length;r--;){var i,a=e[r],s=a.indexOf("="),c=null;0>s?i=a:(i=a.substring(0,s),c=a.substring(s+2,a.length-1));var u=[i,c],l=p(i,t,n&&t==n);if(l){var h=null,v=null;if(c){c=c.replace(/&amp;/gm,"&");var m,s=c.indexOf("=>");0>s?h=c:(h=c.substring(0,s),m=c.substring(s+2,c.length)),h=h.trim(),v=f(m)}var g=o(l)?l[0]:l,b=!0;switch(g){case"for":t["for"]=d(h,v,u,n),b=!1;break;case"if":t["if"]=h,b=!1;break;case"else-if":t.elseif=h,b=!1;break;case"else":t["else"]=!0,b=!1;break;case"html":t.html=h,b=!1}b&&(u.push({dName:g,dArgsAry:l[1],dFilter:l[2]}),u.push({vExp:h,vFilterAry:v}),t.directives[i]=u)}else t.attributes[i]=c}}function h(e,t){e=e.trim();var n=[];if(e){for(var r=null,i=0;r=He.exec(e);){var o=e.substring(i,r.index);o&&n.push(o),n.push([r[1],f(r[2],!0)]),i=r.index+r[0].length}i<e.length&&n.push(e.substr(i)),n.length<1&&n.push(e);var a=new z;a.txtQ=n,t.children.push(a)}}function f(e,t){var n=[];if(e)for(var r=e.split("|"),i=0;i<r.length;i++){var o=r[i].split(":");n.push({name:o[0].trim(),param:o.slice(1)})}return n}function p(e,t,r){var i=null,o=null,a=null;if(Se.test(e)){var s=e.replace(Me,""),c=s.indexOf(Le);c>-1&&(s=s.substring(0,c)),i=s;var u=e.indexOf(Le);switch(u>-1&&(o=e.substr(u+1)),s){case"if":case"else-if":case"else":case"for":case"html":return s}n(Fe[s],t?t.$name:"ROOT","there is no handler of directive '"+s+"' ")}else e[0]===je?(i="on",o=e.substr(1)):e[0]!==De||r||(i="bind",o=e.substr(1));if(o){var l=o.indexOf(Ce);l>-1&&(a=o.substr(l+1),o=o.substring(0,l)),o=o.split(Le)}return i?[i,o,a]:i}function d(e,t,r,i){var o=null,a=e,s=t;n(a.match(/^([\s\S]*?)\s+as\s+([\s\S]*?)$/),i?i.name:"ROOT",qe.COMPILE.EACH,"invalid for expression : "+a);var c=RegExp.$2,u=c.split(","),l=u.length>1?u[0]:null,h=u.length>1?u[1]:u[0],f=RegExp.$1;return o=f.match(/^([\s\S]*?)\s+to\s+([\s\S]*?)$/)?[l,h,s,RegExp.$1,RegExp.$2]:[l,h,s,f]}function v(e,t){if(Ke[e]&&!t._slots&&!t._slotMap)return Ke[e];var n="with(comp){return "+m(e,t,[])+"}";return n=new Function("comp,_ce,_tmp,_ct,_li,_fi",n),Ke[e]=n,n}function m(e,t,r){var i=u(e),o=i[0];n(1==o.length,t.$name,qe.COMPILE.ONEROOT,"should only have one root in your template");var a=o[0];n(a.tag&&"template"!=a.tag&&"slot"!=a.tag&&!a["for"],t.$name,qe.COMPILE.ROOTTAG,"root element cannot be <template> or <slot>"),n(!ze[a.tag],t.$name,qe.COMPILE.ROOTCOMPONENT,"root element <"+a.tag+"> should be a non-component tag"),g(i[1],t._slots,t._slotMap);var e=b(a,r);return e}function g(e,t,n){(t||n)&&e.forEach(function(e){var r=e[0],i=e[1],o=e[2],a=r.children.indexOf(i),s=[a,1];o?n[o]&&s.push(n[o]):s=s.concat(t),r.children.splice.apply(r.children,s)})}function b(e,t){var n="";if(e.tag){var r,i;e["for"]&&(r="forScope"+et++,t=t.concat(r)),i="["+t.toString()+"]";var o="";if(tt[e.rid]=e,!ze[e.tag]){for(var a=!1,s="",c=0;c<e.children.length;c++){var u=e.children[c],l=e.children[c+1],h=b(u,t);if(u["if"]&&!u["for"]&&(a=!0,s=""),a){if(u["else"]){a=!1,o+=","+s+h;continue}if(s&&!u.elseif){a=!1,o+=","+s+"null,"+h;continue}s+=h,(!l||l["if"])&&(o+=","+s+"null")}else o+=","+h}o.length>0&&(o=o.substr(1))}var s=e["if"]||e.elseif,f="",p="";s&&(f="("+s+")?",p=":");var d=y(e.directives),v=e.html||"null",h='_ce(this,"'+e.rid+'",['+o+"],{"+d+"},"+v+","+i;if("template"==e.tag&&(h="_tmp(["+o+"],"+i),h=f+h,e["for"]){var m=(e["for"][0]||"").trim(),g=e["for"][1].trim(),E=e["for"][2],w=e["for"][3],$=e["for"][4],x=w,T="";if(e.attributes["var"]){T=e.attributes["var"];var A=T.replace(/^{|}$/gm,"").split(","),M="";A.forEach(function(e){var t=e.split(":");M+="var "+t[0]+"="+t[1]+";"}),T=M}$&&(x="(function(){var rs=[];for(var i="+w+";i<="+$+";i++)rs.push(i);return rs;}).call(this)"),E.length>0&&(x="_fi("+x+","+O(E)+",comp)"),n="_li("+x+",function("+r+"){with("+r+"){"+T+" return "+h+")"+(p?":null":"")+'}},this,"'+m+'","'+g+'")'}else n=h+")"+p}else{var L=_(e.txtQ);n+="_ct("+L+")"}return n}function y(e){var t="";for(var n in e){var r=e[n],i=r[3].vExp,o=r[2].dName,a="on"===o||"model"===o?JSON.stringify(i):i;t+=',"'+n+'":'+(a||"null")}return t.substr(1)}function _(e){var t="";return e.forEach(function(e){if(e instanceof Array){var n=e[0],r=e[1];t+=r.length>0?"+_fi("+n+","+O(r)+",comp)":"+("+n+")"}else e&&(t+="+"+JSON.stringify(e))}),t=t.replace(/\n/gm,""),t.length>0&&(t=t.substr(1)),t}function O(e){var t="";return e.forEach(function(e){var n='["'+e.name+'",['+e.param.toString()+"]]";t+=","+n}),"["+t.substr(1)+"]"}function E(e,t){var n=t.target,r=!1;do{var i=n._vid;if(void 0!==i){var o=Ye[e];if(o){var a=o[i];if(a){var s=a[0];if("mouseleave"==e){var c=t.target;if(!w(s.dom,c))return;var u=t.toElement||t.relatedTarget;if(w(s.dom,u))return;var l=nt.indexOf(s);l>-1&&nt.splice(l,1)}if("mouseenter"==e){var c=t.target,h=t.relatedTarget;if(w(s.dom,c)&&s.dom!=c&&nt.indexOf(s)>-1)return;if(h&&w(s.dom,h))return;nt.push(s)}var f=a[1];if(0!==e.indexOf("key")||!f||t.key.toLowerCase()==f){var p=a[2],d=a[3],v=a[4],m=At._cs[d];if(v)p.call(m,t,s);else{var g=[m,t,s];if(s._forScopeQ)for(var l=0;l<s._forScopeQ.length;l++)g.push(s._forScopeQ[l]);p.apply(m,g)}r=t.cancelBubble}}}}}while((n=n.parentNode)&&"BODY"!=n.tagName&&!r)}function w(e,t){if(e.contains)return e.contains(t);do{if(e==t)return!0;t=t.parentNode}while(t&&"BODY"!=t.tagName);return!1}function $(e){E("touchstart",e),E("pointerdown",e),ut=setTimeout(function(){E("press",e)},800),pt=!1,dt=!1;var t=e.touches[0];lt={x:t.clientX,y:t.clientY,t:Date.now()}}function x(e){clearTimeout(ut),E("touchmove",e),E("pointermove",e),pt=!0}function T(e){clearTimeout(ut),dt=!0,E("touchcancel",e),E("pointercancel",e)}function A(e){if(clearTimeout(ut),E("touchend",e),E("pointerup",e),!dt)if(pt){var t=e.changedTouches[0],n=t.clientX,r=t.clientY,i=lt,o=i.x,a=i.y,s=i.t,c=Date.now()-s,u=Math.sqrt((n-o)*(n-o)+(r-a)*(r-a))>>0;if(ht>=c&&u>20){var l=Math.atan2(r-a,n-o),h={slope:l,interval:c,distance:u};E("fling",e,h)}}else E("tap",e),Date.now()-ft<300&&E("dbltap",e),ft=Date.now()}function M(e){E("click",e),E("tap",e)}function L(e){E("dblclick",e),E("dbltap",e)}function C(e){E("mousedown",e),E("pointerdown",e),ut=setTimeout(function(){E("press",e)},800)}function k(e){clearTimeout(ut),E("mousemove",e),E("pointermove",e)}function N(e){clearTimeout(ut),E("mouseup",e),E("pointerup",e)}function S(e){clearTimeout(ut),E("pointercancel",e)}function R(e){E("mouseout",e),E("mouseleave",e);var t=e.target,n=[];nt.forEach(function(r){if(w(r.dom,t)){var i=e.toElement||e.relatedTarget;w(r.dom,i)||n.push(r)}}),n.forEach(function(e){var t=nt.indexOf(e);nt.splice(t,1)})}function P(e){E("mouseover",e),E("mouseenter",e)}function B(e){E("mousewheel",e)}function j(e,t,n,r,i){this.name=e,this.newVal=t,this.oldVal=n,this.type=r,this.object=i}function D(e,t){this.key,this.handler=e,this.component=t,this.monitors=[],t._watchers.push(this)}function H(){this.key,this.target,this.value,this.watchers=[]}function U(e,t){t.$state=I(e,null,t,!0)}function I(e,t,n,r){var o=Array.isArray(e)?F([],n,t):{};for(var a in e){var s=e[a],c=null;if(t&&t.value){var u=Object.getOwnPropertyDescriptor(t.value,a);u&&u.get&&(c=u.get.__mm__)}var u=Object.getOwnPropertyDescriptor(e,a);u&&u.get&&(c=u.get.__mm__),c||(c=new H),i(s)&&(s=I(s,c,n,!1)),Q(a,s,o,n,r,c)}return o}function Q(e,t,n,r,o,a){a.key=e,a.target=n,a.value=t;var s=function(){return a.collect(),a.value};Object.defineProperty(s,"__mm__",{value:a});var c={enumerable:!0,configurable:!0,get:s,set:function(e){e!==a.value&&(i(e)&&(e=I(e,a,r,!1),Array.isArray(e)&&(e=F(e,r,a))),a.notify(e,"update"))}};return Object.defineProperty(n,e,c),o&&Object.defineProperty(r,e,c),a}function F(e,t,n){return e.push!==gt?e:(Object.defineProperties(e,{push:{value:function(){var e=this.length,r=gt.apply(this,arguments);if(r>e){var i=I(this,n,t,!1);n.notify(i,"add")}return r}},pop:{value:function(){var e=this.length,t=bt.call(this);return this.length<e&&n.notify(this,"del"),t}},unshift:{value:function(){var e=this.length,r=_t.apply(this,arguments);if(r>e){var i=I(this,n,t,!1);n.notify(i,"add")}return r}},shift:{value:function(){var e=this.length,t=yt.call(this);return this.length<e&&n.notify(this,"del"),t}},splice:{value:function(){var e=null;arguments[1]>-1&&(e="del"),arguments.length>2&&(e="del"==e?"update":"add");var r=this.length,i=Ot.apply(this,arguments);if("del"!=e){{I(this,n,t,!1)}n.notify(this,e)}return(i&&i.length>0||r!=this.length)&&n.notify(this,e),i}},reverse:{value:function(){return this.length<1?this:(Et.call(this),n.notify(this,"update"),this)}},sort:{value:function(e){return this.length<1?this:(wt.call(this,e),n.notify(this,"update"),this)}}}),e)}function z(e){this.rid=xt++,this.tag=e,this.children=[],this.directives={},this.attributes={},this.txtQ,this.slotMap={},this.outerHTML,this.innerHTML}function Y(e,t){this.tag=e,this.txt,this.children=[],this.dom,this.vid=$t++,this.attributes,this.directives=[],this._hasEvent,this._slots,this._comp,this._forScopeQ,this.raw=t}function q(e,t,n,r,i,o){var a=tt[t],s=a.tag,c=new Y(s,a);for(var u in a.directives){var l=a.directives[u];l[1]=r[u],c.directives.push([l[0],l[1],l[2],l[3]])}if(c.attributes=Object.assign({},a.attributes),c._isEl=!0,o.length>0&&(c._forScopeQ=o),ze[s]||"component"==s)return c._comp=!0,c._slots=a.children,c._slotMap=a.slotMap,c;if(null!=i){{var h,f,p="",d="",v=[e,q,J,V,Z,G],g=[];v.length}if(c._forScopeQ)for(var b=0;b<c._forScopeQ.length;b++){var y="forScope"+et++;p+="with("+y+"){",d+="}",v.push(c._forScopeQ[b]),g.push(y)}f=m("<"+s+">"+i+"</"+s+">",e,g);var _=g.length>0?","+g.toString():"",O=new Function("comp,_ce,_tmp,_ct,_li,_fi"+_,"with(comp){"+p+"return "+f+";"+d+"}");h=O.apply(e,v),n=h.children||[]}return n.length>0&&(c.children=[],n.forEach(function(e){e&&(e instanceof Array?e.forEach(function(e){e.parent=c,c.children.push(e)}):(e.parent=c,c.children.push(e)))})),c}function J(e,t){var n=null;t&&(n=[t]);var r=[];return e.length>0&&e.forEach(function(e){if(e)if(e instanceof Array)e.forEach(function(e){if(r.push(e),n){var t=e._forScopeQ;e._forScopeQ=t?n.concat(t):n}});else if(r.push(e),n){var t=e._forScopeQ;e._forScopeQ=t?n.concat(t):n}}),r}function V(e){var t=new Y;return t.txt=e&&e.toString?e.toString():e,t}function Z(e,t,n,r,i){var a=[];return e.forEach(function(e,s){var c={$index:s};r&&(c[r]=s),c[i]=e;var u=t.call(n,c);u&&(o(u)?a=a.concat(u):a.push(u))}),a}function G(e,t,r){for(var i=0;i<t.length;i++){var o=t[i],a=Qe[o[0]];a||(a=r[o[0]]),n(a,r.$name,qe.COMPILE.NOFILTER,"can not find filter '"+o[0]+"'");var s=o[1];s.unshift(e),e=a.apply(r,s)}return e}function W(e,t){var n,r=t.$id;if(e._isEl){if(n=document.createElement(e.tag),n._vid=e.vid,e._cid=r,!e._comp){var i=e.directives;e._comp_directives&&(i=i.concat(e._comp_directives)),i&&i.length>0&&i.forEach(function(n){var r=ve(n,t),i=r[0];i.onBind&&i.onBind(e,r[1])})}for(var o in e.attributes)if(o[0]!==De){var a=e.attributes[o];n.setAttribute(o,a)}if(e.attributes[Re]&&(t.$ref[e.attributes[Re]]=n),e._comp){var s=K(e,e.tag,n,t,e._slots,e._slotMap,e.attributes);e._comp=s}else if(e.children&&e.children.length>0)for(var c=0;c<e.children.length;c++){var s=W(e.children[c],t);n.appendChild(s)}}else n=document.createTextNode(X(e.txt));return e.dom=n,n}function X(e){return e&&e.replace?e.replace(/&lt;/gim,"<").replace(/&gt;/gim,">").replace(/&nbsp;/gim," ").replace(/&amp;/gim,"&"):e}function K(e,t,n,r,i,o,a){"component"==t&&(t=a.is,a[".is"]&&(t=a[".is"],t=new Function("scope","with(scope){return "+t+"}")(r)));var s=new pe(n);return s.$name=t,r.$children.push(s),s.$parent=r,s.$root=r.$root,s.$vnode=e,s._props=a,a[Re]&&(r.$ref[a[Re]]=s),a[Pe]&&(At.id[a[Pe]]=s),e.directives.forEach(function(e){var t=e[2].dName;if("on"===t){var n=e[2].dArgsAry[0],i=e[3].vExp,o=i.replace(/\(.*\)/,""),a=new Function("comp","with(comp){return "+o+"}");e[1]=i.replace(/this\./gim,'impex._cs["'+r.$id+'"].'),a=a.call(r,r),r[o]&&(a=a.bind(r)),a&&s.on(n,a)}}),s._slots=i,s._slotMap=o,s._innerHTML=e.raw.getInnerHTML(),s}function ee(e,t,n){return Tt={},ue(e,t)?ne(e,t,n):(oe(e,t,t.parent?t.parent.children:null,t.parent,n),se(t)),Tt}function te(e,t){var n=At._cs[t._cid];if(!n)return!1;var r=e.raw.attributes,i=n.$vnode.raw.attributes;if(Object.keys(r).length!==Object.keys(i).length)return!1;for(var o in r)if(s(i[o]))return!1;return e.raw.getInnerHTML()==n._innerHTML}function ne(e,t,n){if(e._comp)return Tt[t._cid]=e._forScopeQ,void(t._comp_directives=e.directives);if(e.tag){t._forScopeQ=e._forScopeQ;var r=Object.assign({},t.attributes);t.raw.attributes=e.raw.attributes,t.attributes={};for(var i in t.raw.attributes)t.attributes[i]=t.raw.attributes[i];for(var o=e.directives,a=t.directives,s=re(o),c=re(a),u=[],l=[],h=[],f=a.length;f--;){var p=a[f],d=p[0]+p[3];s[d]||l.push(p)}for(var f=o.length;f--;){var v=o[f],m=v[0]+v[3];c[m]?(c[m][2]=v[2],h.push(v)):u.push(v)}for(var f=l.length;f--;){var g=t.directives.indexOf(l[f]);t.directives.splice(g,1);var b=ve(l[f],n),y=b[0];y.onDestroy&&y.onDestroy(t,b[1])}h.forEach(function(e){var r=ve(e,n),i=r[0];i.onUpdate&&i.onUpdate(t,r[1],t.dom)}),u.forEach(function(e){t.directives.push(e);var r=ve(e,n),i=r[0];i.onBind&&i.onBind(t,r[1])}),t._comp_directives&&t._comp_directives.forEach(function(e){var r=ve(e,n),i=r[0];i.onBind&&i.onBind(t,r[1])}),he(n,t.attributes,r,t.dom,t.tag)}else e.txt!==t.txt&&le(e,t);e.children&&t.children?ie(e.children,t.children,t,n):e.children?ce(t,e.children,n):t.children&&t.children.length>0&&se(t.children)}function re(e){for(var t={},n=e.length;n--;){var r=e[n],i=r[0]+r[3];t[i]=r}return t}function ie(e,t,n,r){if(e.length<1)return void(t.length>0&&se(t));for(var i=0,o=t.length-1,a=0,s=e.length-1,c=t[0],u=t[o],l=e[0],h=e[s];o>=i&&s>=a;)ue(l,c)?(ne(l,c,r),c=t[++i],l=e[++a]):ue(h,u)?(ne(h,u,r),u=t[--o],h=e[--s]):ue(h,c)?(oe(c,ae(u),t,n,r),c=t[i],o--,h=e[--s]):ue(l,u)?(oe(u,c,t,n,r),u=t[o],i++,l=e[++a]):(oe(l,c,t,n,r),se(c),c=t[++i],l=e[++a]);if(i==a&&o>s){var f=t.splice(i,o-s);f.length>0&&se(f)}else if(o>=i&&o>0){var f=t.splice(i,o-i+1);f.length>0&&se(f)}if(s>=a){var p=a==s?[e[a]]:e.splice(a,s-a+1);p.length>0&&oe(p,t[i],t,n,r)}}function oe(e,t,n,r,i){if(n){if(e.dom){var a=n.indexOf(e);a>-1&&n.splice(a,1)}var s=r;if(t)if(a=n.indexOf(t),s=s||t.parent,o(e)){for(var c=e.length;c--;)e[c].parent=s;var u=[a,0].concat(e);n.splice.apply(n,u)}else e.parent=s,n.splice(a,0,e);else o(e)?e.forEach(function(e){n.push(e),e.parent=s}):(e.parent=s,n.push(e))}var l=e.dom;if(l)l.parentNode.removeChild(l);else if(o(e)){for(var h=document.createDocumentFragment(),a=0;a<e.length;a++){var f=e[a],p=W(f,i);h.appendChild(p)}l=h}else l=W(e,i);if(t){var d=t.dom;d.parentNode.insertBefore(l,d)}else r.dom.appendChild(l)}function ae(e){var t=e.parent,n=t.children.indexOf(e);return t.children[n+1]}function se(e){o(e)||(e=[e]);for(var t=e[0].parent,n=e.length;n--;){var r=e[n],i=t.children.indexOf(r);i>-1&&t.children.splice(i,1);var a=r.dom.parentNode;a&&a.removeChild(r.dom),At._cs[r._cid]&&r.getAttribute(Ue)&&At._cs[r._cid].destroy()}}function ce(e,t,n){e.children=t;for(var r=document.createDocumentFragment(),i=0;i<t.length;i++){var o=t[i],a=W(o,n);r.appendChild(a)}e.dom.appendChild(r)}function ue(e,t){return e._comp?t.tag===e.tag?!0:t.tag&&t.getAttribute(Ue)==e.tag?te(e,t):!1:t.tag===e.tag}function le(e,t){t.txt=e.txt;var n=t.dom;n.textContent=e.txt}function he(e,t,n,r,i){for(var o=t,a=n,s=Object.keys(o),c=Object.keys(a),u="input"===i,l=s.length;l--;){var h=s[l],f=c.indexOf(h);0>f?(r.setAttribute(h,o[h]),u&&"value"===h&&(r.value=o[h])):(o[h]!=a[h]&&(r.setAttribute(h,o[h]),u&&"value"===h&&(r.value=o[h])),c.splice(f,1))}for(var l=c.length;l--;)c[l]!==Ue&&r.removeAttribute(c[l]);t[Re]&&(e.$ref[t[Re]]=r);var p=n[Ue];p&&(t[Ue]=p)}function fe(){this._eeMap={}}function pe(e){fe.call(this),this.$id="C_"+Ie++,this.$el=e,this.$ref={},this.$compTags={},this.$name,this.$parent,this.$children=[],this._watchers=[],this._combiningChange=!1,this._updateMap={},At._cs[this.$id]=this}function de(){}function ve(e,t){var n=e[2].dName,r=Fe[n],i=e[2].dArgsAry,o=e[2].dFilter,a=e[1],s=e[3].vExp;return[r,{comp:t,value:a,args:i,exp:s,filter:o}]}function me(e,t,n){if(s(e.txt)&&!e._comp){var r=e.directives;if(e._comp_directives&&(r=r.concat(e._comp_directives)),r&&r.length>0&&r.forEach(function(r){var i=ve(r,t),o=i[0];0==n?o.onActive&&o.onActive(e,i[1],e.dom):o.onUpdate&&o.onUpdate(e,i[1],e.dom)}),e.children&&e.children.length>0)for(var i=0;i<e.children.length;i++)me(e.children[i],t,n)}}function ge(e,t){if(s(e.txt)&&!e._comp){var n=e.directives;if(e._comp_directives&&(n=n.concat(e._comp_directives)),n&&n.length>0&&n.forEach(function(n){var r=ve(n,t),i=r[0];i.onDestroy&&i.onDestroy(e,r[1])}),e.children&&e.children.length>0)for(var r=0;r<e.children.length;r++)ge(e.children[r],t)}}function be(e,t){var r=null,i={},o={},a=null;if(t){r=t.template,i=t.state||{},a=t.input,o=t.computeState;for(var s=Object.keys(t),u=s.length;u--;){var l=s[u];c(t[l])&&(e[l]=t[l])}c(i)&&(i=i.call(e))}if(e._props){var h=ye(e,e.$parent,e._props,a);for(var l in h)i[l]=h[l]}r&&(e.onBeforeCompile&&e.vnode&&(r=e.onBeforeCompile(r,e.vnode.raw)),e._processedTmpl=r.trim().replace(/<!--[\s\S]*?-->/gm,"").replace(/<\s*script[\s\S]*?<\s*\/\s*script\s*>/gm,"").replace(/^\s+|\s+$/gim," ").replace(/>\s([^<]*)\s</,function(e,t){return">"+t+"<"})),U(i,e);for(var l in o){var f=o[l],p=f.get||f;n(p instanceof Function,e.$name,qe.COMPONENT.COMPUTESTATE,"invalid computeState '"+l+"' ,it must be a function or an object with getter")}for(var l in o){var f=o[l],p=f.get||f,d=new D(function(e,t){var n=t.fn.call(this,this);this[t.k]=n},e);d.k=l,d.fn=p,H.target=d,console.log("compute变更监控。。。。",e.$id);var v=p.call(e);H.target=null,console.log("compute变更监控。。。。end"),e.$state[l]=v,e.$state=I(e.$state,null,e,!0)}}function ye(e,t,r,i,o){var o={};if(i)for(var a in i){var c=i[a];c.require&&(o[a]=vt)}var u={};if(r){var l={};for(var a in r){var h=r[a];if(a!=Re)if(a=a.replace(/-[a-z0-9]/g,function(e){return e[1].toUpperCase()}),a[0]===Be){var f=a.substr(1);l[f]=h}else u[a]=h}for(a in l){var p=e.$vnode,d=[t],v="",m="";if(p._forScopeQ)for(var g=0;g<p._forScopeQ.length;g++)v+="with(arguments["+(1+g)+"]){",m+="}",d.push(p._forScopeQ[g]);var b=new Function("scope","with(scope){"+v+"return "+l[a]+m+"}"),y=new D(function(e,n){this[n.k]=n.fn.apply(t,n.args)},e);y.k=a,y.fn=b,y.args=d,H.target=y,console.log("入参变更监控。。。。",e.$id);try{u[a]=b.apply(t,d)}catch(_){n(!1,e.$name,qe.COMPONENT.DEP,"creating dependencies error with prop "+JSON.stringify(a)+": ",_)}H.target=null,console.log("入参变更监控。。。。end")}for(var a in u){var h=u[a];if(i&&a in i){if(delete o[a],s(i[a].type))continue;n(function(e,t,n,r){if(!n[e]||!n[e].type)return!1;var i=n[e].type;i=i instanceof Array?i:[i];var o=typeof t;return t instanceof Array&&(o="array"),"undefined"!==o&&i.indexOf(o)<0?!1:!0}(a,h,i,e),e.$name,qe.INPUT.TYPE,"invalid type ["+(h instanceof Array?"array":typeof h)+"] of input prop ["+a+"];should be ["+(i[a].type&&i[a].type.join?i[a].type.join(","):i[a].type)+"]")}}}return n(0==Object.keys(o).length,e.$name,qe.INPUT.REQUIRE,"input props ["+Object.keys(o).join(",")+"] are required"),u?(e.onPropBind&&(u=e.onPropBind(u)),u):void 0}function _e(e){var t=new D(function(e){this._updateMap[e.name]=e,this._combiningChange||Oe(this),console.log("组件属性变更",arguments)},e);H.target=t,console.log("组件属性变更监控。。。。",e.$id);var n=$e(e);H.target=null,console.log("组件属性变更监控。。。。end");var r=null;if(e.$vnode){r=e.$vnode.parent;var i=r.children,o=i.indexOf(e.$vnode);o>-1&&i.splice(o,1,n),n._comp_directives=e.$vnode.directives}e.$vnode=n,n.parent=r,e.onCompile&&e.onCompile(e.$vnode)}function Oe(e){e._combiningChange=!0,console.log("ready2notify",e.$id),e._updateTimer=setTimeout(function(){we(e,e._updateMap),console.log("update",e.$id),e._updateMap={},e._combiningChange=!1},20)}function Ee(e,t){var n=W(e.$vnode,e);e.onBeforeMount&&e.onBeforeMount(n),e.$el.parentNode.replaceChild(n,e.$el),e.$el=n,e.$name&&(e.$el.setAttribute(Ue,e.$name),e.$vnode.setAttribute(Ue,e.$name)),e.onMount&&e.onMount(e.$el),me(e.$vnode,e,0)}function we(e,t){var n=!0;if(e.onBeforeUpdate&&(n=e.onBeforeUpdate(t)),n!==!1){for(var r=$e(e),i=(ee(r,e.$vnode,e),0);i<e.$children.length;i++){var o=e.$children[i];s(o._processedTmpl)&&o._parse()}e.onUpdate&&e.onUpdate(t),e.$children.forEach(function(e){var t=e.$vnode;t._comp_directives&&t._comp_directives.forEach(function(n){var r=ve(n,e),i=r[0];i.onUpdate&&i.onUpdate(t,r[1],t.dom)})})}}function $e(e){var t=null,r=v(e._processedTmpl,e);try{t=r.call(e,e,q,J,V,Z,G)}catch(i){n(!1,e.$name,qe.COMPILE.ERROR,"compile error with attributes "+JSON.stringify(e.$attributes)+": ",i)}return t}function xe(e,t,n){var r=(e.target||e.srcElement).value,i=t.getAttribute("number");s(i)||(r=parseFloat(r));var o=t.getAttribute("debounce");if(o){t.debounceTimer&&(clearTimeout(t.debounceTimer),t.debounceTimer=null);var a=this;t.debounceTimer=setTimeout(function(){clearTimeout(t.debounceTimer),t.debounceTimer=null,Ae(t,r,a||n)},o)}else Ae(t,r,this||n)}function Te(e,t,n){var r=e.target||e.srcElement,i=r.value,a="with(scope){return "+t._exp+"}",s=new Function("scope",a),c=null;if(c=s(this?this:n),c=o(c)?c.concat():[c],r.checked)c.push(i);else{var u=c.indexOf(i);u>-1&&c.splice(u,1)}Ae(t,c,n)}function Ae(e,t,n){var r=new Function("comp","v","comp."+e._exp+"= v;");r(n,t)}var Me="x-",Le=":",Ce=".",ke="{{",Ne="}}",Se=/^x-.*/,Re="ref",Pe="id",Be=".",je="@",De=".",He=new RegExp(ke+"(.+?)(?:(?:(?:=>)|(?:=&gt;))(.+?))?"+Ne,"img"),Ue="impex-component",Ie=0,Qe={},Fe={},ze={component:1},Ye={},qe={COMPONENT:{CONTAINER:1001,TEMPLATEPROP:1002,LOADERROR:1003,LOADTIMEOUT:1004,TEMPLATETAG:1005,COMPUTESTATE:1006,DEP:1007},COMPILE:{ONEROOT:2001,EACH:2002,HTML:2003,ROOTTAG:2004,ROOTCOMPONENT:2005,NOFILTER:2006,ERROR:2007},INPUT:{REQUIRE:3001,TYPE:3002},STORE:{NOSTORE:4001}},Je=["br","hr","img","input","link","meta","area","base","col","embed","keygen","param","source","track","wbr"],Ve=new RegExp("<([-a-z0-9]+)((?:\\s+[-a-zA-Z0-9_"+je+De+Le+"]+(?:\\s*=\\s*(?:(?:\"[^\"]*\")|(?:'[^']*')))?)*)\\s*(?:/?)>","im"),Ze=new RegExp("[a-zA-Z_"+je+De+"][-a-zA-Z0-9_"+je+De+Le+"]*(?:\\s*=\\s*(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>\\s]+))?","img"),Ge=/<\/([-a-z0-9]+)>/im,We=/<\/([-a-z0-9]+)>/gim,Xe="slot",Ke=[],et=0,tt={},nt=[],rt=self.navigator.userAgent.toLowerCase(),it=rt.indexOf("android")>0?!0:!1,ot=rt.indexOf("iphone")>0?!0:!1,at=rt.indexOf("ipad")>0?!0:!1,st=rt.indexOf("windows phone")>0?!0:!1,ct=ot||at||it||st;if(ct){var ut,lt,ht=200,ft=0,pt=!1,dt=!1;document.addEventListener("touchstart",$,!0),document.addEventListener("touchmove",x,!0),document.addEventListener("touchend",A,!0),document.addEventListener("touchcancel",T,!0)}else{document.addEventListener("click",M,!0),document.addEventListener("dblclick",L,!0),document.addEventListener("mousedown",C,!0),document.addEventListener("mousemove",k,!0),document.addEventListener("mouseup",N,!0),window.addEventListener("blur",S,!0);var vt=null==self.onmousewheel?"mousewheel":"DOMMouseScroll";document.addEventListener(vt,B,!0),document.addEventListener("mouseout",R,!0),document.addEventListener("mouseover",P,!0);var ut}document.addEventListener("input",function(e){E("input",e)},!0),document.addEventListener("change",function(e){E("change",e)},!0),document.addEventListener("keydown",function(e){E("keydown",e)},!0),document.addEventListener("keypress",function(e){E("keypress",e)},!0),document.addEventListener("keyup",function(e){E("keyup",e)},!0),document.addEventListener("focus",function(e){E("focus",e)},!0),document.addEventListener("blur",function(e){E("blur",e)},!0);var mt=null==self.onwheel?"wheel":"mousewheel";document.addEventListener(mt,function(e){E("wheel",e)},!0),document.addEventListener("scroll",function(e){E("scroll",e)},!0),D.prototype={update:function(e){this.handler&&this.handler.call(this.component,e,this)},dispose:function(){this.monitors.forEach(function(e){e.removeWatcher(this)},this),this.component=this.handler=this.monitors=this.key=null},depend:function(e){this.monitors.indexOf(e)<0&&this.monitors.push(e)}},H.prototype={notify:function(e,t){this.value=e;var n=new j(this.key,e,this.value,t,this.target);this.watchers.forEach(function(e){e.key=this.key,e.update(n)},this)},collect:function(){H.target&&(H.target.depend(this),this.watchers.indexOf(H.target)<0&&this.watchers.push(H.target))},removeWatcher:function(e){var t=this.watchers.indexOf(e);t>-1&&this.watchers.splice(t,1),console.log("removeWatcher",this.key)}};var gt=Array.prototype.push,bt=Array.prototype.pop,yt=Array.prototype.shift,_t=Array.prototype.unshift,Ot=Array.prototype.splice,Et=Array.prototype.reverse,wt=Array.prototype.sort,$t=0,xt=0;z.prototype={getInnerHTML:function(){var e=new RegExp("<s*/s*"+this.tag+"s*>","img"),t=this.innerHTML.trim(),n=e.exec(t);return n?t.substring(0,n.index):t},getOuterHTML:function(){return this.outerHTML+this.getInnerHTML()+"</"+this.tag+">"}},Y.prototype={on:function(e,t,n){var r=Ye[e];r||(r=Ye[e]={});var i=!1;if(c(t)&&(i=!0),i)r[this.vid]=[this,n,t,this._cid,i];else{var o=this.getAttribute("var");if(o){var a=o.replace(/^{|}$/gm,"").split(","),s="";a.forEach(function(e){var t=e.split(":");s+="var "+t[0]+"="+t[1]+";"}),o=s}var u="",l="";if(this._forScopeQ)for(var h=0;h<this._forScopeQ.length;h++)u+="with(arguments["+(3+h)+"]){",l+="}";r[this.vid]=[this,n,new Function("comp,$event,$vnode","with(comp){"+u+o+";"+t+l+"}"),this._cid]}this._hasEvent=!0},off:function(e){var t=Ye[e];if(t)t[this.vid]=null;else if(!e)for(var n in Ye)t=Ye[n],t&&(t[this.vid]=null)},setAttribute:function(e,t){return this.attributes[e]=t,this},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){this.attributes[e]=null,delete this.attributes[e]}};var Tt=null;fe.prototype={on:function(e,t,n){return this._eeMap[e]=[t,n||this],this},off:function(e){this._eeMap[e]=null},emit:function(e){var t=this._eeMap[e];if(t){var n=t[0],r=t[1];if(n){for(var i=[],o=1;o<arguments.length;o++)i.push(arguments[o]);return n.apply(r,i)}}},getEvent:function(e){return this._eeMap[e]}},de.prototype=fe.prototype,pe.prototype=new de,pe.prototype.constructor=pe.constructor,r({$watch:function(e,t){var n=new D(function(e){t&&t.call(this,e.newVal,e.oldVal,e.name)},this);console.log("watcher变更监控。。。。",this.$id),H.target=n;var r=new Function("state","return state."+e);return r(this.$state),H.target=null,console.log("watcher变更监控。。。。end"),this},destroy:function(){this.onDestroy&&this.onDestroy();var e=this.$id;if(this._watchers.forEach(function(e){e.dispose()}),this._watchers=null,this._updateTimer&&(clearTimeout(this._updateTimer),this._updateTimer=null),this.$parent){var t=this.$parent.$children.indexOf(this);t>-1&&this.$parent.$children.splice(t,1),this.$parent=null}for(;this.$children.length>0;)this.$children[0].destroy();this.$children=At._cs[e]=null,delete At._cs[e],ge(this.$vnode,this),this.$vnode=this.$el=this.$compTags=this.$root=this.$ref=this.$id=null},onPropChange:function(e,t,n){this[e]=t},$mount:function(e){e&&(a(e)&&e.trim()&&(e=document.querySelector(e)),e.append(this.$el)),Ee(this,this.$vnode)},_parse:function(e){e=e||ze[this.$name],be(this,e),this.onCreate&&this.onCreate(),this._processedTmpl&&_e(this),this.$el&&this.$mount();for(var t=this.$children.length;t--;)this.$children[t]._parse()}},pe.prototype);var At=new function(){this.id={},this.version={v:[0,99,1],state:"alpha",toString:function(){return At.version.v.join(".")+" "+At.version.state}},this.website="http://impexjs.org",this.config=function(e){var t=e.delimiters||[];ke=t[0]||"{{",Ne=t[1]||"}}",He=new RegExp(ke+"(.+?)(?:(?:(?:=>)|(?:=&gt;))(.+?))?"+Ne,"img")},this.component=function(e,t){return ze[e]=t,this},this.hasComponentOf=function(e){return!!ze[e]},this.directive=function(e,t){return Fe[e]=t,this},this.filter=function(e,t){return Qe[e]=t,this},this.create=function(e){var t=null,r=e.el;if(r instanceof HTMLElement)n("BODY"!==r.tagName,"ROOT",qe.COMPONENT.CONTAINER,"root element must be inside <body> tag"),t=r.outerHTML;else if(a(r)&&r.trim())try{r=document.querySelector(r),n("BODY"!==r.tagName,"ROOT",qe.COMPONENT.CONTAINER,"root element must be inside <body> tag"),t=r.outerHTML}catch(i){t=r}var o=new pe(a(r)?null:r);return o.$name="ROOT",o.$root=o,e.template=t,o._parse(e),o},Object.defineProperty(this,"_cs",{enumerable:!1,writable:!0,value:{}}),this.Component=pe,this.EventEmitter=fe};At.directive("style",{onBind:function(e,t){var n=t.value;if(a(n)){for(var r={},i=n.split(";"),o=i.length;o--;)if(i[o]){var s=i[o].split(":");r[s[0]]=s[1]}n=r}var c=e.getAttribute("style")||"";for(var u in n){var l=this.filterName(u),h=n[u];l=l.replace(/[A-Z]/gm,function(e){return"-"+e.toLowerCase()}),c+=l+":"+h+";"}e.setAttribute("style",c)},onUpdate:function(e,t){e.setAttribute("style",e.raw.attributes.style),this.onBind(e,t)},onDestroy:function(e){s(e.raw.attributes.style)?e.removeAttribute("style"):e.setAttribute("style",e.raw.attributes.style)},filterName:function(e){return e.replace(/-([a-z])/gim,function(e,t){return t.toUpperCase()})}}).directive("class",{onBind:function(e,t){var n=t.value,r=e.getAttribute("class")||"",i=r.trim().replace(/\s+/gm," ").split(" "),s=null;if(a(n))s=n.split(" ");else if(o(n))s=n;else{s=[];for(var c in n){var u=n[c];u&&s.push(c)}}s.forEach(function(e){e&&i.indexOf(e.trim())<0&&i.push(e)}),e.setAttribute("class",i.join(" "))},onUpdate:function(e,t){e.setAttribute("class",e.raw.attributes["class"]),this.onBind(e,t)},onDestroy:function(e,t){s(e.raw.attributes["class"])?e.removeAttribute("class"):e.setAttribute("class",e.raw.attributes["class"])}}).directive("on",{onBind:function(e,t){for(var n=t.args,r=n.length;r--;)e.on(n[r],t.value,t.filter)},onDestroy:function(e,t){for(var n=t.args,r=n.length;r--;)e.off(n[r])}}).directive("bind",{onBind:function(e,t){for(var n=t.args,r=n.length;r--;){var i=n[r];switch(i){case"style":Fe[i].onUpdate(e,t);break;case"class":Fe[i].onUpdate(e,t);break;default:e.setAttribute(i,t.value)}}},onUpdate:function(e,t){this.onBind(e,t)},onDestroy:function(e,t){for(var n=t.args,r=n.length;r--;){var i=n[r];switch(i){case"style":Fe[i].onDestroy(e,t);break;case"class":Fe[i].onDestroy(e,t);break;default:e.removeAttribute(i)}}}}).directive("show",{onBind:function(e,t){var n=e.getAttribute("style")||"";return n=t.value?n.replace(/;display\s*:\s*none\s*;?/,""):n.replace(/;display:none;/,"")+";display:none;",
e.setAttribute("style",n),n},onUpdate:function(e,t,n){var r=this.onBind(e,t);n.setAttribute("style",r)},onDestroy:function(e){var t=e.getAttribute("style");t&&(t=t.replace(/;display\s*:\s*none\s*;?/,""),e.setAttribute("style",t))}}).directive("cloak",{}).directive("model",{onBind:function(e,t){switch(e._exp=t.exp,e.tag){case"select":e.on("change",this.handleChange);break;case"input":var n=e.attributes.type;if("radio"==n||"checkbox"==n){e.on("change",this.handleChange);break}default:e.on("input",xe)}},handleChange:function(e,t){{var n=e.target,r=n.tagName.toLowerCase();n.value}switch(r){case"textarea":case"input":var i=n.getAttribute("type");switch(i){case"radio":xe(e,t,this);break;case"checkbox":Te(e,t,this)}break;case"select":var o=n.getAttribute("multiple");if(null!==o){for(var a=[],s=n.options.length;s--;){var c=n.options[s];c.selected&&a.push(c.value)}Ae(t,a,this)}else xe(e,t,this)}}}),At.filter("json",function(e){return JSON.stringify(e)}).filter("filterBy",function(e,t,n){var r=e;if(!o(r))return e;var i=[];if(c(t))for(var a=r.length;a--;){var s=t.call(this,r[a]);s&&i.unshift(r[a])}else for(var a=r.length;a--;){var u=r[a];n?(!t||(u[n]+"").indexOf(t)>-1)&&i.unshift(u):(!t||u.indexOf&&u.indexOf(t)>-1)&&i.unshift(u)}return i}).filter("limitBy",function(e,t,n){return o(e)?(e=e.concat(),t?e.splice(n||0,t):e):e}).filter("orderBy",function(e,t,n){return(t||n)&&o(e)?(e=e.concat(),e.sort(function(e,n){var r=t?e[t]:e,i=t?n[t]:n;return"string"==typeof r?r.localeCompare(i):"number"==typeof r?r-i:(r+"").localeCompare(i)}),"desc"===n&&e.reverse(),e):e}),"object"==typeof module&&"object"==typeof module.exports?module.exports=At:e.impex=At}(window||this);