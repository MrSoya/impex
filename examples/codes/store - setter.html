<!DOCTYPE html>
<html >
    <head>
        <title>Impex Demo</title>
        <meta http-equiv="content-type" content="text/html;charset=utf-8">
        <style type="text/css">
            label{
                display: block;
            }
        </style>
    </head>
    <body >
        <div id="demo">
            storeX({{x}}) + storeY({{y}}) 
            <x-panel>
                <input type="number" .value="x" x-model="x" number>
            </x-panel>
            <label>
                x:<input x-model="x" .value="x" number>
            </label>
            <label>
                y:<input x-model="y" .value="y" number>
            </label>
            
        </div>
        
        <script type="text/javascript" src="../lib/impex/impex.dev.all.js"></script>
        <script type="text/javascript" src="../../ext/impex.ext.store.js"></script>
        <script type="text/javascript">
            //store 不能直接修改state，必须通过action
            var store = new impex.Store({
                state:{
                    x:1,
                    y:2
                },
                actions:{
                    setX:function(val){
                        this.state.x = val;
                    },
                    setY:function(val){
                        this.state.y = val;
                    }
                }
            });

            impex.component('x-panel',{
                template:'<span> + x({{x}}) = {{z}} <p><slot></slot></p></span>',
                state:{
                    x:store.state.x
                },
                computedState:{
                    z:function(){
                        return this.state.x + store.state.x + store.state.y;
                    }
                },
                onUpdate:function(argument) {
                    console.log('state: ',argument)
                },
                callback:function(argument) {
                    console.log('store: ',argument)
                },
                onCompile:function(){
                    store.subscribe('addx addy',this.callback);
                }
            });

            //渲染
            var debug = impex.render('#demo',{
                computedState:{
                    x:{
                        get:function () {
                            return store.state.x;
                        },
                        set:function(val) {
                            store.commit('setX',val);
                        }   
                    },
                    y:{
                        get:function () {
                            return store.state.y;
                        },
                        set:function(val) {
                            store.commit('setY',val);
                        }   
                    }
                }
            });
            
        </script>
    </body>
</html>